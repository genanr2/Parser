#include <io.h>
#include <SYS\STAT.H>
#include <stdio.h>
#include <direct.h>
#include <stdlib.h>
#include <string.h>
#include "calc.h"
#include <iostream.h>
#include <fstream.h>
#include <afx.h>
FILE*fileXls;
char*start[]={"D0","CF","11","E0","A1","B1","1A","E1","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","3e","00","03","00","fe","ff","09","00",
						"06","00","00","00","00","00","00","00","00","00","00","00","02","00","00","00",
						"01","00","00","00","00","00","00","00","00","10","00","00","86","00","00","00",
						"01","00","00","00","FE","ff","ff","ff","00","00","00","00","00","00","00","00",
						"72","00","00","00","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff","ff",
						"FD","ff","ff","ff","85","00","00","00","03","00","00","00","04","00","00","00",
						"05","00","00","00","06","00","00","00","07","00","00","00","08","00","00","00",
						"09","00","00","00","0a","00","00","00","0b","00","00","00","0c","00","00","00",
						"0d","00","00","00","0e","00","00","00","0f","00","00","00","10","00","00","00",
						"11","00","00","00","12","00","00","00","13","00","00","00","14","00","00","00",
						"15","00","00","00","16","00","00","00","17","00","00","00","18","00","00","00",
						"19","00","00","00","1a","00","00","00","1b","00","00","00","1c","00","00","00",
						"1d","00","00","00","1e","00","00","00","1f","00","00","00","20","00","00","00",
						"21","00","00","00","22","00","00","00","23","00","00","00","24","00","00","00",
						"25","00","00","00","26","00","00","00","27","00","00","00","28","00","00","00",
						"29","00","00","00","2A","00","00","00","2B","00","00","00","2C","00","00","00",
						"2D","00","00","00","2E","00","00","00","2F","00","00","00","30","00","00","00",
						"31","00","00","00","32","00","00","00","33","00","00","00","34","00","00","00",
						"35","00","00","00","36","00","00","00","37","00","00","00","38","00","00","00",
						"39","00","00","00","3A","00","00","00","3B","00","00","00","3C","00","00","00",
						"3D","00","00","00","3e","00","00","00","3F","00","00","00","40","00","00","00",
						"41","00","00","00","42","00","00","00","43","00","00","00","44","00","00","00",
						"45","00","00","00","46","00","00","00","47","00","00","00","48","00","00","00",
						"49","00","00","00","4A","00","00","00","4B","00","00","00","4C","00","00","00",
						"4D","00","00","00","4E","00","00","00","4F","00","00","00","50","00","00","00",
						"51","00","00","00","52","00","00","00","53","00","00","00","54","00","00","00",
						"55","00","00","00","56","00","00","00","57","00","00","00","58","00","00","00",
						"59","00","00","00","5A","00","00","00","5B","00","00","00","5C","00","00","00",
						"5D","00","00","00","5E","00","00","00","5F","00","00","00","60","00","00","00",
						"61","00","00","00","62","00","00","00","63","00","00","00","64","00","00","00",
						"65","00","00","00","66","00","00","00","67","00","00","00","68","00","00","00",
						"69","00","00","00","6A","00","00","00","6B","00","00","00","6C","00","00","00",
						"6D","00","00","00","6E","00","00","00","6F","00","00","00","70","00","00","00",
						"71","00","00","00","73","00","00","00","FD","ff","ff","ff","74","00","00","00",
						"75","00","00","00","76","00","00","00","77","00","00","00","78","00","00","00",
						"79","00","00","00","7A","00","00","00","7B","00","00","00","7C","00","00","00",
						"7D","00","00","00","7E","00","00","00","7F","00","00","00","80","00","00","00",
						"52","00","6F","00","6F","00","74","00","20","00","45","00","6E","00","74","00",
						"72","00","79","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"16","00","05","00","ff","ff","ff","ff","ff","ff","ff","ff","02","00","00","00",
						"20","08","02","00","00","00","00","00","C0","00","00","00","00","00","00","46",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","31","E6","CF",
						"36","30","BF","01","87","00","00","00","80","12","00","00","00","00","00","00",
						"57","00","6F","00","72","00","6B","00","62","00","6F","00","6F","00","6B","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"12","00","02","01","0b","00","00","00","ff","ff","ff","ff","ff","ff","ff","ff",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","02","00","00","00","C3","02","01","00","00","00","00","00",
						"5F","00","56","00","42","00","41","00","5F","00","50","00","52","00","4F","00",
						"4A","00","45","00","43","00","54","00","5F","00","43","00","55","00","52","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"22","00","01","01","01","00","00","00","09","00","00","00","08","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","60","6C","9B","CF","36","30","BF","01","00","31","E6","CF",
						"36","30","BF","01","00","00","00","00","00","00","00","00","00","00","00","00",
						"56","00","42","00","41","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"08","00","01","00","ff","ff","ff","ff","ff","ff","ff","ff","04","00","00","00",
						"00","00","00","00","00","00","00","00","00","00","00","00","00","00","00","00",
						"00","00","00","00","60","D6","B3","CF","36","30","BF","01","40","9F","C4","CF",
						"36","30","BF","01","00","00","00","00","00","00","00","00","00","00","00","00",0};
char*bof[]={"09","08","10","00","00","06","05","00","AF","18","CD","07","41","40","00","00","06",
						"01","00","00",0};
char*interfaceHdr[]={"E1","00","02","00","B0","04",0};

char*MMS[]={"C1","00","02","00","00","00",0};
char*INTERFACEEND[]={"E2","00","00","00",0};
char*writeAccess[]={"5C","00","70","00","04","00","01","13","04","35","04","3D",
										"04","30","04","20","20","20","20","20","20","20","20","20","20","20","20","20",
										"20","20","20","20","20","20","20","20","20","20","20","20","20","20","20","20",
										"20","20","20","20","20","20","20","20","20","20","20","20","20","20","20","20",
										"20","20","20","20","20","20","20","20","20","20","20","20","20","20","20","20",
										"20","20","20","20","20","20","20","20","20","20","20","20","20","20","20","20",
										"20","20","20","20","20","20","20","20","20","20","20","20","20","20","20","20",
										"20","20","20","20","20","20","20","20",0};
char*codePage[]={"42","00","02","00","B0","04",0};
char*unused[]={"61","01","02","00","00","00",0};
char*Unknown1[]={"C0","01","00","00",0};
char*TABID[]={"3D","01","02","00","01","00",0};
char*OBPROJ[]={"D3","00","00","00",0};
char*Unknown2[]={"BD","01","00","00",0};
char*FNGROUPCOUNT[]={"9C","00","02","00","0E","00",0};
char*WINDOWPROTECT[]={"19","00","02","00","00","00",0};
char*PROTECT[]={"12","00","02","00","00","00",0};
char*PASSWORD[]={"13","00","02","00","00","00",0};
char*Unknown3[]={"AF","01",0};

LONG MyAtol(LPTSTR szString,BOOL bHex,LPBOOL bSuccess);
void writeXls()
{
//	char fileName[128];
//	ofstream ifs((LPCTSTR)*fileName);//}
	ofstream ifs("all2.xls",ios::trunc|ios::binary);//}
	try
	{
		int i=0;
		char**str1=start;
		long dig=5;
		LPBOOL success;
		while(*str1!=NULL)
		{
			dig=MyAtol(start[i],true,success);if(*success)ifs<<(TCHAR)dig;i++;str1++;
		}
		str1=bof;
		i=0;
		while(*str1!=NULL)
		{
			dig=MyAtol(bof[i],true,success);if(*success)ifs<<(TCHAR)dig;i++;str1++;
		}
  }catch(char*ss){MessageBox(NULL,ss,"Программа записи.",MB_OK);}
	ifs.close();
}
int HexDigitToInt(IN char c)
{     
	if(c>='0'&&c<='9'){return(c-'0');}
	if(tolower(c)>='a'&&tolower(c)<='f'){return(tolower(c)-'a'+10);}return-1;
}    
LONG MyAtol(LPTSTR szString,BOOL bHex,LPBOOL bSuccess)
{   
	LPTSTR p;LONG l;LONG lMultiplier;BOOL bDigit;
	if(bHex)lMultiplier=16;//else lMultiplier=10;
	p=szString;l=0;
	while(*p)//while chars
	{
		bDigit=FALSE;//set to false for each char that we look at
		if(*p>=(TCHAR)'0'&&*p<=(TCHAR)'9')//is it an ascii char ?
			{bDigit=TRUE;l+=(*p-(TCHAR)'0');}
		if(bHex)
		{	//or hex?
			if(*p>=(TCHAR)'A'&&*p<=(TCHAR)'F'){l+=(*p-(TCHAR)'A'+10);bDigit=TRUE;}
			if(*p>=(TCHAR)'a'&&*p<=(TCHAR)'f'){l+=(*p-(TCHAR)'a'+10);bDigit=TRUE;}
		}if(bDigit==FALSE){*bSuccess=FALSE;return 0;}
		p++;//get next char
		if(*p)//if there is going to be at least one more char
			l*=lMultiplier;//then multiply what we have by the multiplier...
	}*bSuccess=TRUE;
	return l;//success! return the value.
}
